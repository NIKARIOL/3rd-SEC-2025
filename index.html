<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“˜ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø·Ø§Ù„Ø¨</title>
  <style>
    body {
      font-family: "Cairo", sans-serif;
      padding: 2em;
      background: #f9f9f9;
      text-align: right;
    }

    h1 {
      text-align: center;
    }

    input, button {
      font-size: 1.2em;
      padding: 0.5em;
      margin: 0.5em 0;
      width: 100%;
    }

    .tabs {
      display: flex;
      margin-bottom: 1em;
    }

    .tabs button {
      flex: 1;
      font-size: 1em;
      padding: 0.5em;
      background: #ddd;
      border: none;
      cursor: pointer;
    }

    .tabs button.active {
      background: #007bff;
      color: white;
    }

    #results {
      background: white;
      border: 1px solid #ccc;
      padding: 1em;
      margin-top: 1em;
    }
  </style>
</head>
<body>
  <h1>ğŸ“˜ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø·Ø§Ù„Ø¨</h1>

  <div class="tabs">
    <button id="idTab" class="active">ğŸ”¢ Ø¨Ø­Ø« Ø¨Ø§Ù„Ø±Ù‚Ù…</button>
    <button id="nameTab">ğŸ”¤ Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…</button>
  </div>

  <div id="idSearch">
    <input id="idInput" type="number" placeholder="Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„ÙˆØ³ Ù‡Ù†Ø§">
    <button onclick="searchById()">Ø¨Ø­Ø«</button>
  </div>

  <div id="nameSearch" style="display:none;">
    <input id="nameInput" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… ÙƒØ§Ù…Ù„Ø§Ù‹ Ø£Ùˆ Ø¬Ø²Ø¡ Ù…Ù†Ù‡">
    <button onclick="searchByName()">Ø¨Ø­Ø«</button>
  </div>

  <div id="results"></div>

  <script>
    const idTab = document.getElementById('idTab');
    const nameTab = document.getElementById('nameTab');
    const idSearch = document.getElementById('idSearch');
    const nameSearch = document.getElementById('nameSearch');
    const resultsDiv = document.getElementById('results');

    idTab.onclick = () => {
      idTab.classList.add('active');
      nameTab.classList.remove('active');
      idSearch.style.display = 'block';
      nameSearch.style.display = 'none';
      resultsDiv.innerHTML = '';
    };

    nameTab.onclick = () => {
      nameTab.classList.add('active');
      idTab.classList.remove('active');
      nameSearch.style.display = 'block';
      idSearch.style.display = 'none';
      resultsDiv.innerHTML = '';
    };

    // Arabic normalization rules
    function normalizeArabic(text) {
      return text
        .replace(/\s+/g, '') // remove all spaces
        .replace(/[Ø¥Ø£Ø¢Ù±]/g, 'Ø§')
        .replace(/[Ù‰ÛŒ]/g, 'ÙŠ')
        .replace(/[Ø©]/g, 'Ù‡')
        .replace(/Ø¤/g, 'Ùˆ')
        .replace(/Ø¦/g, 'ÙŠ')
        .replace(/Ù“|Ù’|ÙŒ|Ù|Ù‹|Ù|Ù|Ù|Ù‘/g, '') // remove diacritics if any
        .toLowerCase();
    }

    function firstLetterHex(text) {
      const norm = normalizeArabic(text.trim());
      if (!norm) return '';
      return norm[0].charCodeAt(0).toString(16).toUpperCase().padStart(4, '0');
    }

    async function searchById() {
      const id = parseInt(document.getElementById('idInput').value);
      if (isNaN(id)) return alert("â— Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… ØµØ­ÙŠØ­");
      resultsDiv.innerHTML = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...";

      const groupIdx = Math.floor(id / 1000);
      const filename = `jsons/group_${groupIdx.toString().padStart(4, '0')}.json`;

      try {
        const res = await fetch(filename);
        const data = await res.json();
        const student = data.find(entry => entry[0] == id);

        if (student) {
          resultsDiv.innerHTML = `
            <h3>Ø§Ù„Ø§Ø³Ù…: ${student[1]}</h3>
            <p>Ø§Ù„Ø¯Ø±Ø¬Ø©: ${student[2]}</p>
            <p>Ø§Ù„Ø­Ø§Ù„Ø©: ${student[3]}</p>
          `;
        } else {
          resultsDiv.innerHTML = "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø§Ù„Ø¨.";
        }
      } catch (err) {
        resultsDiv.innerHTML = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.";
      }
    }

    async function searchByName() {
      const rawInput = document.getElementById('nameInput').value.trim();
      if (!rawInput) return alert("â— Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø£ÙˆÙ„Ø§Ù‹");
      resultsDiv.innerHTML = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...";

      const searchKey = normalizeArabic(rawInput);
      const groupHex = firstLetterHex(searchKey);

      if (!groupHex) return resultsDiv.innerHTML = "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø£ÙˆÙ„ Ø­Ø±Ù.";

      const filename = `name_groups/group_${groupHex}.json`;

      try {
        const res = await fetch(filename);
        const data = await res.json();

        const matches = data.filter(student => {
          const normName = normalizeArabic(student.name);
          return normName.includes(searchKey);
        });

        if (matches.length === 0) {
          resultsDiv.innerHTML = "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬.";
        } else {
          resultsDiv.innerHTML = matches.map(s => `
            <div style="border-bottom:1px solid #ccc;margin-bottom:1em;">
              <strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${s.name}<br>
              <strong>Ø§Ù„Ø±Ù‚Ù…:</strong> ${s.id}<br>
              <strong>Ø§Ù„Ø¯Ø±Ø¬Ø©:</strong> ${s.score}<br>
              <strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${s.status}
            </div>
          `).join('');
        }
      } catch (err) {
        resultsDiv.innerHTML = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.";
      }
    }
  </script>
</body>
</html>
